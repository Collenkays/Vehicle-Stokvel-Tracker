<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Storage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Supabase Storage Test</h1>

    <div class="info test-result">
        <strong>Instructions:</strong>
        <ol>
            <li>Open this file in your browser</li>
            <li>Click "Test Storage Bucket" to check if the bucket exists</li>
            <li>If the bucket doesn't exist, create it in Supabase Dashboard</li>
        </ol>
    </div>

    <button onclick="testStorageBucket()">Test Storage Bucket</button>
    <button onclick="listBuckets()">List All Buckets</button>

    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        // Get environment variables
        const SUPABASE_URL = prompt('Enter your Supabase URL:', 'https://your-project.supabase.co')
        const SUPABASE_ANON_KEY = prompt('Enter your Supabase Anon Key:', 'your-anon-key')

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        window.testStorageBucket = async function() {
            const resultsDiv = document.getElementById('results')
            resultsDiv.innerHTML = '<div class="info test-result">Testing...</div>'

            try {
                // Try to list files in the bucket (will fail if bucket doesn't exist)
                const { data, error } = await supabase.storage
                    .from('proof-of-payments')
                    .list()

                if (error) {
                    resultsDiv.innerHTML = `
                        <div class="error test-result">
                            <strong>❌ Bucket Not Found or Error</strong>
                            <p><strong>Error:</strong> ${error.message}</p>
                            <p><strong>Action Required:</strong></p>
                            <ol>
                                <li>Go to Supabase Dashboard → Storage</li>
                                <li>Click "New bucket"</li>
                                <li>Name: <code>proof-of-payments</code></li>
                                <li>Public: ✅ Check this box</li>
                                <li>Click "Create bucket"</li>
                            </ol>
                        </div>
                    `
                } else {
                    resultsDiv.innerHTML = `
                        <div class="success test-result">
                            <strong>✅ Bucket Exists!</strong>
                            <p>The "proof-of-payments" bucket is properly configured.</p>
                            <p>Files in bucket: ${data.length}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `
                }
            } catch (err) {
                resultsDiv.innerHTML = `
                    <div class="error test-result">
                        <strong>❌ Error</strong>
                        <p>${err.message}</p>
                    </div>
                `
            }
        }

        window.listBuckets = async function() {
            const resultsDiv = document.getElementById('results')
            resultsDiv.innerHTML = '<div class="info test-result">Listing buckets...</div>'

            try {
                const { data, error } = await supabase.storage.listBuckets()

                if (error) {
                    resultsDiv.innerHTML = `
                        <div class="error test-result">
                            <strong>❌ Error Listing Buckets</strong>
                            <p>${error.message}</p>
                        </div>
                    `
                } else {
                    const hasBucket = data.some(b => b.name === 'proof-of-payments')

                    resultsDiv.innerHTML = `
                        <div class="${hasBucket ? 'success' : 'error'} test-result">
                            <strong>${hasBucket ? '✅' : '❌'} Buckets Found: ${data.length}</strong>
                            <p>${hasBucket ? 'The "proof-of-payments" bucket exists!' : 'The "proof-of-payments" bucket is missing!'}</p>
                            <p><strong>Available buckets:</strong></p>
                            <pre>${JSON.stringify(data.map(b => ({ name: b.name, public: b.public })), null, 2)}</pre>
                        </div>
                    `
                }
            } catch (err) {
                resultsDiv.innerHTML = `
                    <div class="error test-result">
                        <strong>❌ Error</strong>
                        <p>${err.message}</p>
                    </div>
                `
            }
        }
    </script>
</body>
</html>
